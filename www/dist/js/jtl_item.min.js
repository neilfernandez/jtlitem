/*
 * JTL Item v2.0 - http://apex.world/plugins/
 *
 * Licensed under MIT License (MIT)
 * Jorge Rimblas Â© 2017
*/
$.widget("tk.jtl_item",{options:{lang:"en",lang_codes:["en","fr","es"],messages:null,fieldSize:30,fieldRows:5,fieldMaxLength:80,dialogTitle:null},_createPrivateStorage:function(){var e=this;e._values={apexItemId:"",controlsId:"",fieldSize:30,fieldMaxLength:80,dataJSON:{},curr_lang_index:0,languages:{},tagMap:{},messages:$.parseJSON(e.options.messages),totalLanguages:0,disabled:!1,focusOnClose:"BUTTON",newRecord:!1,signalChange:!1},e._elements={$window:{},$document:{},$body:{},$hiddenInput:{},$displayInput:{},$fieldset:{},$mlsButton:{},$dialog:{},$dialogContent:{},$saveButton:{},$cancelButton:{},$buttonContainer:{}}},_create:function(){var e=this;e._createPrivateStorage(),e._values.apexItemId=$(e.element).attr("id"),e._values.controlsId=e._values.apexItemId+"_fieldset",e._initElements(),e._initBaseElements(),e._values.languages=JSON.parse(e.options.lang_codes),e._values.totalLanguages=e._values.languages.length,e._initDataJSON(),e._initLanguageMap(),e._values.curr_lang_index=function(e,t){var n=null,a=-1;for(n=0;e.length>n&&-1==a;n+=1)e[n].l===t&&(a=n);return a}(e._values.dataJSON,e.options.lang),e._elements.$displayInput.bind("change",{uiw:e},e._syncHiddenField),e._elements.$document.bind("apexbeforepagesubmit",{uiw:e},e._syncHiddenField),e._elements.$mlsButton.bind("click",{uiw:e},e._handleOpenClick),apex.debug.message(4,"Registering with apex.widget.initPageItem: "+e._elements.$displayInput.attr("id")),apex.widget.initPageItem(e._elements.$hiddenInput.attr("id"),{setValue:function(t,n){e._elements.$displayInput.val(n),e._syncHiddenField()},getValue:function(){return e._elements.$hiddenInput.val()},setFocus:function(){e._elements.$displayInput.focus()},enable:function(){e.enable()},disable:function(){e.disable()}})},_initElements:function(){var e=this;e._elements.$window=$(window),e._elements.$document=$(document),e._elements.$body=$(document.body),e._elements.$dialog=$("div.jtlitem-dialog")},_initDialogElements:function(){var e=this;e._elements.$dialog=$("div.jtlitem-dialog"),e._elements.$dialogContent=$("div.jtlitem-content"),e._elements.$saveButton=$("button.jtlitem-save-button"),e._elements.$cancelButton=$("button.jtlitem-cancel-button")},_initBaseElements:function(){var e=this;e._elements.$hiddenInput=e.element,e._elements.$displayInput=$("#"+e._values.apexItemId+"_DISPLAY"),e._values.fieldSize="TEXT"===e.options.itemType?e._elements.$displayInput.attr("size"):e._elements.$displayInput.attr("cols"),"TEXTAREA"===e.options.itemType&&(e._values.fieldRows=e._elements.$displayInput.attr("rows")),e._values.fieldMaxLength=e._elements.$displayInput.attr("maxlength"),e._elements.$fieldset=$("#"+e._values.controlsId),e._elements.$mlsButton=e._elements.$fieldset.find("button.jtlitem-modal-open")},_initDataJSON:function(){var e=this,t=[],n=e._elements.$hiddenInput.val();n?(e._values.dataJSON=JSON.parse(n),e._values.newRecord=!1):(e._values.languages.forEach(function(e){t.push({l:e,tl:""})}),e._elements.$hiddenInput.val(JSON.stringify(t)),e._values.dataJSON=t,e._values.newRecord=!0)},_syncHiddenField:function(e){var t,n;if(n=(t=void 0!==e?e.data.uiw:this)._values.curr_lang_index,t._values.newRecord)for(var a=t._values.totalLanguages-1;a>=0;a--)t._values.dataJSON[a].tl=t._elements.$displayInput.val();else t._values.dataJSON[n].tl=t._elements.$displayInput.val();t._elements.$hiddenInput.val(JSON.stringify(t._values.dataJSON)),t._initLanguageMap()},_initDialogButtons:function(){var e=this;e._elements.$cancelButton.bind("click",{uiw:e},e._handleCancelButtonClick),e._elements.$saveButton.bind("click",{uiw:e},e._handleSaveButtonClick)},_handleCancelButtonClick:function(e){e.data.uiw._elements.$dialog.dialog("close")},_handleSaveButtonClick:function(e){var t,n=e.data.uiw;n._elements.$dialogContent.find(".jtlitem-value").each(function(e,a){apex.debug.message(4,e+"("+a.dataset.lang+"):"+a.value),n._values.dataJSON[e].l=a.dataset.lang,n._values.dataJSON[e].tl=a.value,n._values.curr_lang_index==e&&(t=a.value)}),n._initLanguageMap(),n._elements.$displayInput.val(t),n._elements.$hiddenInput.val(JSON.stringify(n._values.dataJSON)),n._values.newRecord=!1,n._elements.$dialog.dialog("close")},_signalChange:function(){var e=this._elements.$hiddenInput[0],t=this._elements.$displayInput[0];apex.jQuery(e).trigger("change"),apex.jQuery(t).trigger("change")},_handleOpenClick:function(e){var t=e.data.uiw;t._syncHiddenField(e),t._showDialog()},_initLanguageMap:function(){var e,t=this,n=null;for(e=t._values.dataJSON,t._values.tagMap={},n=0;e.length>n;n+=1)t._values.tagMap[e[n].l]=e[n].tl},_hasTag:function(e){return this._values.tagMap[e]},_showDialog:function(){var e,t,n=this,a=n._values.curr_lang_index;e='<table class="t-Report-report" summary="Available Translations">\n <tr>\n  <th class="t-Report-colHead">'+n._values.messages.languageLabel+'</th>  <th class="t-Report-colHead u-tL">'+n._values.messages.languageValue+"</th> </tr>\n <tr>\n",$.each(n._values.languages,function(t,l){e+=' <tr>\n  <td class="t-Report-cell t-Form-inputContainer u-tC'+(a==t?" selected":"")+'">'+apex.util.escapeHTMLAttr(l)+'</td>  <td class="t-Report-cell t-Form-inputContainer u-tL'+(a==t?" selected":"")+'">',"TEXT"===n.options.itemType?e+='    <input type="text" class="text_field apex-item-text jtlitem-value" data-lang="'+l+'" value="'+apex.util.escapeHTMLAttr(n._hasTag(l))+'" size="'+n._values.fieldSize+'" maxlength="'+n._values.fieldMaxLength+'"></td>':e+='    <textarea class="textarea apex-item-textarea jtlitem-value" data-lang="'+l+'" cols="'+n._values.fieldSize+'" rows="'+n._values.fieldRows+'">'+apex.util.escapeHTMLAttr(n._hasTag(l))+"</textarea>",e+=" </tr>\n"}),e+="</table>\n",t='<div class="jtlitem-dialog"><div class="jtlitem-container ui-widget">\n  <div class="jtlitem-button-container">\n     <button class="jtlitem-cancel-button t-Button">       <span class="t-Button-label">'+n._values.messages.cancelButton+'</span>     </button>\n     <button class="jtlitem-save-button t-Button t-Button--hot">       <span class="t-Button-label">'+n._values.messages.applyChanges+'</span>       <span class="t-Icon t-Icon--right fa fa-check"></span>     </button>\n  </div>\n  <div class="jtlitem-content">\n'+e+"  </div>\n</div></div>\n",n._elements.$body.append(t),n._initElements(),n._elements.$dialog.dialog({closeOnEscape:!0,title:n.options.dialogTitle,autoResize:!0,minWidth:400,minHeight:250,width:"auto",height:"auto",modal:!0,position:{my:"left",at:"left center",of:n._elements.$displayInput[0]},open:function(){n._initDialogElements(),n._initDialogButtons(),n._elements.$dialogContent.find("input").first().focus()},close:function(){$(this).dialog("destroy"),n._elements.$dialog.remove(),n._elements.$document.find("div.jtlitem-dialog").remove(),"BUTTON"===n._values.focusOnClose?n._elements.$mlsButton.focus():"INPUT"===n._values.focusOnClose&&n._elements.$displayInput.focus(),n._values.focusOnClose="BUTTON"}}).on("keydown",function(e){e.keyCode===$.ui.keyCode.ESCAPE&&n._elements.$dialog.dialog("close"),e.stopPropagation()})},disable:function(){var e=this;!1===e._values.disabled&&(e._elements.$displayInput.attr("disabled","disabled"),e._elements.$hiddenInput.attr("disabled","disabled"),e._elements.$mlsButton.attr("disabled","disabled").unbind("click",e._handleOpenClick)),e._values.disabled=!0},enable:function(){var e=this;!0===e._values.disabled&&(e._elements.$displayInput.removeAttr("disabled"),e._elements.$hiddenInput.removeAttr("disabled"),e._elements.$mlsButton.removeAttr("disabled").bind("click",{uiw:e},e._handleOpenClick),e._values.disabled=!1)}});
//# sourceMappingURL=jtl_item.min.js.map
